<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WhatsApp Messages - Summarizer</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header>
    <nav>
        <a href="index.html" id="nav-home">Home</a>
        <a href="#" class="active" id="nav-whatsapp">WhatsApp Messages</a>
        <a href="docs.html" id="nav-docs">Docs</a>
        <a href="about.html" id="nav-about">About</a>
    </nav>
</header>

<main class="container">
    <h1>WhatsApp Messages</h1>

    <div id="whatsapp-messages" style="max-height: 400px; overflow-y: auto; background-color: #222; padding: 15px; border-radius: 12px; white-space: pre-wrap; text-align: left; color: white;">
        Loading WhatsApp messages...
    </div>

    <button id="backBtn" style="margin-top: 20px; background: #f44336; border: none; border-radius: 12px; color: white; padding: 14px 28px; font-weight: 700; font-size: 1.1rem; cursor: pointer;">
        Back
    </button>
</main>

<script>
    async function loadWhatsAppMessages() {
      const container = document.getElementById('whatsapp-messages');
      try {
        const response = await fetch('http://localhost:8001/twilio/messages');
        if (!response.ok) throw new Error('Network response was not ok');

        const messages = await response.json();
        if (messages.length === 0) {
          container.textContent = 'No messages found.';
          return;
        }

        container.innerHTML = messages.map(msg => `
          <div style="margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px;">
            <strong>From:</strong> ${escapeHtml(msg.sender)}<br/>
            <strong>Message:</strong><br/>${escapeHtml(msg.message)}
          </div>
        `).join('');
      } catch (err) {
        container.textContent = 'Failed to load messages: ' + err.message;
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    document.getElementById('backBtn').addEventListener('click', () => {
      window.location.href = 'index.html'; // go back to home page
    });

    // Load messages on page load
    window.addEventListener('DOMContentLoaded', loadWhatsAppMessages);
</script>
</body>
</html>
